
<!DOCTYPE html>
<meta charset="utf-8">
<html>

  <head>
    <title>Typhoon Haiyan Shelter Cluster Activities</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/dc.css"/>
    <link rel="stylesheet" type="text/css" href="css/site.css"/>
    <script src="//code.jquery.com/jquery.js"></script>
    <script src="js/data.js"></script>
  </head>
  <body>
    <div class ="col-sm-4 col-md-offset4" id="loading">
        <h1>Loading... (~1.5MB)</h1><small>Does not work on IE8 or older</small>
    </div>
    <div class="container" id="dashboard">
      <div class="row">
        <div class="col-lg-3">
          <h3>Typhoon Haiyan - Shelter Cluster Activities</h3>
          <div class="col-xs-12">Explore Shelter Cluster data for Typhoon Haiyan. Source <a href="data/Shelter_cluster_activities_haiyan.csv" target="_blank" >Shelter Cluster</a> 13th December</div>
          <div id="count-info" class="col-xs-12">
            <span class="filter-count "></span> selected out of <span class="total-count "></span> records
          </div>
          <div class="col-xs-12">
            <a class="reset btn btn-primary btn-sm" id="reset" href="javascript:dc.filterAll();dc.redrawAll();">Reset All</a>
          </div>
        </div>
        <div class="col-lg-9">
          <div class="row">
            <div id="status" class="col-xs-4">
                <div class="inlinetitle">Status</div>
            </div>
            <div id="intervention" class="col-xs-4">
              <div class="inlinetitle">Intervention</div>
            </div>
            <div id="target" class="col-xs-4">
              <div class="inlinetitle">Target</div>
            </div>              
          </div>          
        </div>
      </div>
      <div class="row">
        <div id="map" class="col-lg-8">            
          <h4>Map</h4><p><a href="javascript:municipalitiesMapShow();">Municipalities</a> - Provinces</p>
        </div>
        <div id="map2" class="col-lg-8">
          <h4>Map</h4><p>Municipalities - <a href="javascript:provincesMapShow();">Provinces</a></p>
        </div>
        <div id="orgs" class="col-lg-4">
          <h4>Top Ten Organisations</h4>
          <div class="col-xs-12">By activity count</div>
        </div>       
      </div> 
      <div class="row row-logo">
        <a href="https://www.sheltercluster.org" target="_blank"><img src="images/Logo-Shelter-Cluster-Philippines-600.jpg" id="arclogo" class="logo" /></a>
         Produced with support from <a href="http://redcross.org.uk" target="_blank"><img src="images/British_Red_Cross.png" id="brclogo" class="logo" /></a>
      </div>
      Contact <a href="mailto:sjohnson@redcross.org.uk">Simon Johnson</a>
    </div>
      <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-46399763-1']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>
    <script>
        
        function provincesMapShow(){
            $('#map2').hide();           
            $('#map').show();
            map2_chart.filterAll();
            dc.redrawAll();
        }
        
        function municipalitiesMapShow(){
            $('#map').hide();
            $('#map2').show();
        }
        $('#dashboard').hide();
        $('#map').hide();
        var target_chart = dc.pieChart("#target");
        var intervention_chart = dc.pieChart("#intervention");
        var status_chart = dc.pieChart("#status");
        var map_chart = dc.geoChoroplethChart("#map");
        var org_chart = dc.rowChart("#orgs");
        var map2_chart = dc.geoChoroplethChart("#map2");
        
        d3.csv("data/Shelter_cluster_activities_haiyan.csv", function(csv_data){
            var cf = crossfilter(csv_data);
            
            cf.target = cf.dimension(function(d) { return d.Target_Group; });
            cf.intervention = cf.dimension(function(d) { return d.Intervention_type; });
            cf.status = cf.dimension(function(d) { return d.Status; });
            cf.pcode = cf.dimension(function(d) { return d.PCODE; });
            cf.organisation = cf.dimension(function(d) { return d.AGENCY; });
            cf.mcode = cf.dimension(function(d) { return d.MCODE; });
            
            var target = cf.target.group();
            var intervention = cf.intervention.group();
            var status = cf.status.group();
            var pcode = cf.pcode.group();
            var organisation = cf.organisation.group();
            var mcode = cf.mcode.group();
            var all = cf.groupAll();
            
            status_chart.width(180).height(180)
                .dimension(cf.status)
                .group(status)
                .innerRadius(10)
                .colors(['#65b630',
                        '#84c559',
                        '#a3d383',
                        '#c1e2ac',
                        '#e0f0d6'])
                .colorDomain([0,4])
                .colorAccessor(function(d, i){return i%5;});
                
            intervention_chart.width(180).height(180)
                .dimension(cf.intervention)
                .group(intervention)
                .innerRadius(10)
                .colors(['#ffb100',
                        '#ffc133',
                        '#ffd066',
                        '#ffe099',
                        '#ffefcc'])
                .colorDomain([0,4])
                .colorAccessor(function(d, i){return i%5;});
            
            target_chart.width(180).height(180)
                .dimension(cf.target)
                .group(target)
                .innerRadius(10)
                .colors(['#fc0000',
                        '#fd3333',
                        '#fd6666',
                        '#fe9999',
                        '#fecccc'])
                .colorDomain([0,1])
                .colorAccessor(function(d, i){return i%2;});
            
            org_chart.width(320).height(300)
                .dimension(cf.organisation)
                .group(organisation)
                .elasticX(true)
                .data(function(group) {
                    return group.top(10);
                })
                .colors(['#04314c'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;});
                
            dc.dataCount("#count-info")
		.dimension(cf)
		.group(all);
                            
            d3.json("data/Phil_provinces.geojson", function (provincesJSON) {
                
                map_chart.width(700).height(400)
                    .dimension(cf.pcode)
                    .group(pcode)
                    .colors(['#AAAAAA', '#7f1416'])
                    .colorDomain([0, 1])
                    .colorAccessor(function (d) {
                        if(d>0){
                            return 1;
                        } else {
                            return 0;
                        }
                    })
                    .overlayGeoJson(provincesJSON.features, "Province", function (d) {
                        return d.properties.P_Str;
                    })
                    .projection(d3.geo.mercator().center([124.0,11.0]).scale(5000))
                    .title(function (d) {
                        return "Province: " + pcode2prov[d.key];
                    });
                    
                    d3.json("data/Phil_municipalities.geojson", function (municJSON){
                        map2_chart.width(700).height(400)
                            .dimension(cf.mcode)
                            .group(mcode)
                            .colors(['#AAAAAA', '#7f1416'])
                            .colorDomain([0, 1])
                            .colorAccessor(function (d) {
                                if(d>0){
                                    return 1;
                                } else {
                                    return 0;
                                }
                            })
                            .overlayGeoJson(municJSON.features, "Municipalities", function (d) {
                                return d.properties.MUN_P_STR;
                            })
                            .projection(d3.geo.mercator().center([124.0,11.0]).scale(5000))
                            .title(function (d) {
                                return "Municipality: " + mcode2mun[d.key];
                            });
                            $('#loading').hide();
                            $('#dashboard').show();
                            dc.renderAll();                            
                    });                    
                });            
        });
    </script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.min.js"></script>
  </body>
</html>
